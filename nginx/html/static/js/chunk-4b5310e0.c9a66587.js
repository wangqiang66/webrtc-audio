(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4b5310e0"],{1737:function(e,n,t){"use strict";t.r(n);var a=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"demo"},[t("div",{staticClass:"rtcBox"},[t("div",[e._m(0),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.allowHangup&&e.messageOpen,expression:"!allowHangup && messageOpen"}],staticClass:"chat-box"},[t("h5",[e._v("收消息")]),t("p",[e._v(e._s(e.receiveText))])])]),t("div",[t("div",{staticClass:"video-box"},[t("video",{attrs:{src:"",id:"rtcB",controls:"",autoplay:""}}),t("h5",[e._v("B")]),t("button",{attrs:{disabled:e.allowCall},on:{click:e.call}},[e._v("call")]),t("button",{attrs:{disabled:e.allowHangup},on:{click:e.hangup}},[e._v("hangup")])]),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.allowHangup&&e.messageOpen,expression:"!allowHangup && messageOpen"}],staticClass:"chat-box"},[t("h5",[e._v("发消息")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.sendText,expression:"sendText"}],domProps:{value:e.sendText},on:{input:function(n){n.target.composing||(e.sendText=n.target.value)}}}),t("br"),t("button",{on:{click:e.send}},[e._v("发送")])])])])])},r=[function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"video-box"},[t("video",{attrs:{src:"",id:"rtcA",controls:"",autoplay:""}}),t("h5",[e._v("A")])])}],s=(t("7f7f"),t("96cf"),t("3b8d")),c=t("f499"),o=t.n(c),i={name:"local1",data:function(){return{peerA:null,peerB:null,channelA:null,channelB:null,offerOption:{offerToReceiveAudio:1,offerToReceiveVideo:1},allowCall:!0,allowHangup:!0,messageOpen:!1,sendText:"",receiveText:""}},methods:{send:function(){this.channelB.send(o()({name:this.sendText})),this.sendText=""},start:function(){this.state="2",this.newRecognition.start()},stop:function(){this.state="1",this.newRecognition.stop()},call:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.peerA&&this.peerB||this.initPeer(),e.prev=1,e.next=4,this.peerB.createOffer(this.offerOption);case 4:return n=e.sent,e.next=7,this.onCreateOffer(n);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),console.log("createOffer: ",e.t0);case 12:this.allowCall=!0,this.allowHangup=!1;case 14:case"end":return e.stop()}},e,this,[[1,9]])}));function n(){return e.apply(this,arguments)}return n}(),hangup:function(){this.peerA.close(),this.peerB.close(),this.channelA.close(),this.channelB.close(),this.peerA=null,this.peerB=null,this.channelA=null,this.channelB=null,this.sendText="",this.receiveText="",this.allowCall=!1,this.allowHangup=!0},onCreateOffer:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(n){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerB.setLocalDescription(n);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),console.log("Offer-setLocalDescription: ",e.t0);case 8:return e.prev=8,e.next=11,this.peerA.setRemoteDescription(n);case 11:e.next=16;break;case 13:e.prev=13,e.t1=e["catch"](8),console.log("Offer-setRemoteDescription: ",e.t1);case 16:return e.prev=16,e.next=19,this.peerA.createAnswer();case 19:return t=e.sent,e.next=22,this.onCreateAnswer(t);case 22:e.next=27;break;case 24:e.prev=24,e.t2=e["catch"](16),console.log("createAnswer: ",e.t2);case 27:case"end":return e.stop()}},e,this,[[0,5],[8,13],[16,24]])}));function n(n){return e.apply(this,arguments)}return n}(),onCreateAnswer:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerA.setLocalDescription(n);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),console.log("answer-setLocalDescription: ",e.t0);case 8:return e.prev=8,e.next=11,this.peerB.setRemoteDescription(n);case 11:e.next=16;break;case 13:e.prev=13,e.t1=e["catch"](8),console.log("answer-setRemoteDescription: ",e.t1);case 16:case"end":return e.stop()}},e,this,[[0,5],[8,13]])}));function n(n){return e.apply(this,arguments)}return n}(),initPeer:function(){var e=this,n=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;this.peerA=new n,this.peerA.addStream(this.localstream),this.peerA.onicecandidate=function(n){n.candidate&&e.peerB.addIceCandidate(n.candidate)},this.peerA.ondatachannel=function(n){console.log(n),e.channelA=n.channel,e.channelA.binaryType="arraybuffer",e.channelA.onopen=function(e){console.log("channelA onopen",e)},e.channelA.onclose=function(e){console.log("channelA onclose",e)},e.channelA.onmessage=function(n){e.receiveText=JSON.parse(n.data).name,console.log("channelA onmessage",n.data)}},this.peerB=new n,this.peerB.onaddstream=function(e){console.log("event-stream",e);var n=document.querySelector("#rtcB");n.srcObject=e.stream},this.channelB=this.peerB.createDataChannel("messagechannel"),console.log("this.channelB",this.channelB),this.channelB.binaryType="arraybuffer",this.channelB.onopen=function(n){console.log("channelB onopen",n),e.messageOpen=!0},this.channelB.onclose=function(e){console.log("channelB onclose",e)},this.peerB.onicecandidate=function(n){n.candidate&&e.peerA.addIceCandidate(n.candidate)},this.allowCall=!1},createMedia:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 2:this.localstream=e.sent,n=document.querySelector("#rtcA"),n.srcObject=this.localstream,this.initPeer();case 6:case"end":return e.stop()}},e,this)}));function n(){return e.apply(this,arguments)}return n}()},mounted:function(){var e=this;this.$nextTick(function(){e.createMedia()})}},l=i,u=(t("fc47"),t("2877")),h=Object(u["a"])(l,a,r,!1,null,null,null);n["default"]=h.exports},"7f7f":function(e,n,t){var a=t("86cc").f,r=Function.prototype,s=/^\s*function ([^ (]*)/,c="name";c in r||t("9e1e")&&a(r,c,{configurable:!0,get:function(){try{return(""+this).match(s)[1]}catch(e){return""}}})},a21f:function(e,n,t){var a=t("584a"),r=a.JSON||(a.JSON={stringify:JSON.stringify});e.exports=function(e){return r.stringify.apply(r,arguments)}},cd81:function(e,n,t){},f499:function(e,n,t){e.exports=t("a21f")},fc47:function(e,n,t){"use strict";var a=t("cd81"),r=t.n(a);r.a}}]);