(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ffa67d12"],{"0794":function(t,e,i){},"2fdb":function(t,e,i){"use strict";var n=i("5ca1"),a=i("d2c8"),s="includes";n(n.P+n.F*i("5147")(s),"String",{includes:function(t){return!!~a(this,t,s).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},"454f":function(t,e,i){i("46a7");var n=i("584a").Object;t.exports=function(t,e,i){return n.defineProperty(t,e,i)}},"46a7":function(t,e,i){var n=i("63b6");n(n.S+n.F*!i("8e60"),"Object",{defineProperty:i("d9f6").f})},5147:function(t,e,i){var n=i("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(i){try{return e[n]=!1,!"/./"[t](e)}catch(a){}}return!0}},6762:function(t,e,i){"use strict";var n=i("5ca1"),a=i("c366")(!0);n(n.P,"Array",{includes:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")("includes")},"85f2":function(t,e,i){t.exports=i("454f")},a05d:function(t,e,i){"use strict";var n=i("0794"),a=i.n(n);a.a},aae3:function(t,e,i){var n=i("d3f4"),a=i("2d95"),s=i("2b4c")("match");t.exports=function(t){var e;return n(t)&&(void 0!==(e=t[s])?!!e:"RegExp"==a(t))}},b0b4:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=i("85f2"),a=i.n(n);function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),a()(t,n.key,n)}}function r(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}},d225:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}i.d(e,"a",function(){return n})},d2c8:function(t,e,i){var n=i("aae3"),a=i("be13");t.exports=function(t,e,i){if(n(e))throw TypeError("String#"+i+" doesn't accept regex!");return String(a(t))}},e656:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"demo"},[i("div",{staticClass:"rtcBox"},[i("ul",t._l(t.handleList,function(e){return i("li",{key:e.type},["color"===e.type?i("el-color-picker",{attrs:{"show-alpha":"",disabled:t.allowHangup},on:{change:t.colorChange},model:{value:t.color,callback:function(e){t.color=e},expression:"color"}}):t._e(),["color","lineWidth","polygon"].includes(e.type)?t._e():i("button",{class:{active:t.currHandle===e.type},attrs:{disabled:"cancel"===e.type?t.allowHangup||t.allowCancel:"go"===e.type?t.allowHangup||t.allowGo:t.allowHangup},on:{click:function(i){return t.handleClick(e)}}},[t._v("\n                    "+t._s(e.name)+"\n                ")]),"polygon"===e.type?i("el-popover",{attrs:{placement:"top",width:"400",trigger:"click"}},[i("el-input-number",{attrs:{"controls-position":"right",min:3,max:10},on:{change:t.sidesChange},model:{value:t.sides,callback:function(e){t.sides=e},expression:"sides"}}),i("button",{class:{active:t.currHandle===e.type},attrs:{slot:"reference",disabled:t.allowHangup},on:{click:function(i){return t.handleClick(e)}},slot:"reference"},[t._v(t._s(e.name))])],1):t._e(),"lineWidth"===e.type?i("el-popover",{attrs:{placement:"top",width:"400",trigger:"click"}},[i("el-slider",{attrs:{max:20},on:{change:t.lineWidthChange},model:{value:t.lineWidth,callback:function(e){t.lineWidth=e},expression:"lineWidth"}}),i("button",{attrs:{slot:"reference",disabled:t.allowHangup},slot:"reference"},[t._v(t._s(e.name)+" "),i("i",[t._v(t._s(t.lineWidth+"px"))])])],1):t._e()],1)}),0),i("div",[i("canvas",{ref:"canvas",attrs:{width:"400",height:"300"}}),i("h5",[t._v("白板操作")])]),i("div",[i("video",{attrs:{src:"",id:"rtcB",playsinline:"",autoplay:""}}),i("h5",[t._v("演示画面")]),i("button",{attrs:{disabled:t.allowCall},on:{click:t.call}},[t._v("call")]),i("button",{attrs:{disabled:t.allowHangup},on:{click:t.hangup}},[t._v("hangup")])])])])},a=[],s=(i("96cf"),i("3b8d")),r=(i("6762"),i("2fdb"),i("ebd66")),o={name:"whiteboard",data:function(){return{peerA:null,peerB:null,offerOption:{offerToReceiveAudio:1,offerToReceiveVideo:1},allowCall:!0,allowHangup:!0,handleList:[{name:"圆",type:"arc"},{name:"线条",type:"line"},{name:"矩形",type:"rect"},{name:"多边形",type:"polygon"},{name:"橡皮擦",type:"eraser"},{name:"撤回",type:"cancel"},{name:"前进",type:"go"},{name:"清屏",type:"clear"},{name:"线宽",type:"lineWidth"},{name:"颜色",type:"color"}],color:"rgba(19, 206, 102, 1)",currHandle:"line",lineWidth:5,palette:null,allowCancel:!0,allowGo:!0,sides:3}},methods:{initPalette:function(){this.palette=new r["a"](this.$refs["canvas"],{drawColor:this.color,drawType:this.currHandle,lineWidth:this.lineWidth,allowCallback:this.allowCallback})},allowCallback:function(t,e){this.allowCancel=!t,this.allowGo=!e},sidesChange:function(){this.palette.changeWay({sides:this.sides})},colorChange:function(){this.palette.changeWay({color:this.color})},lineWidthChange:function(){this.palette.changeWay({lineWidth:this.lineWidth})},handleClick:function(t){["cancel","go","clear"].includes(t.type)?this.palette[t.type]():(this.palette.changeWay({type:t.type}),["color","lineWidth"].includes(t.type)||(this.currHandle=t.type))},start:function(){this.state="2",this.newRecognition.start()},stop:function(){this.state="1",this.newRecognition.stop()},call:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.peerA&&this.peerB||this.initPeer(),t.prev=1,t.next=4,this.peerB.createOffer(this.offerOption);case 4:return e=t.sent,t.next=7,this.onCreateOffer(e);case 7:t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),console.log("createOffer: ",t.t0);case 12:this.allowCall=!0,this.allowHangup=!1;case 14:case"end":return t.stop()}},t,this,[[1,9]])}));function e(){return t.apply(this,arguments)}return e}(),hangup:function(){this.peerA.close(),this.peerB.close(),this.peerA=null,this.peerB=null,this.allowCall=!1,this.allowHangup=!0,this.palette.destroy(),this.palette=null},onCreateOffer:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(e){var i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.peerB.setLocalDescription(e);case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0),console.log("Offer-setLocalDescription: ",t.t0);case 8:return t.prev=8,t.next=11,this.peerA.setRemoteDescription(e);case 11:t.next=16;break;case 13:t.prev=13,t.t1=t["catch"](8),console.log("Offer-setRemoteDescription: ",t.t1);case 16:return t.prev=16,t.next=19,this.peerA.createAnswer();case 19:return i=t.sent,t.next=22,this.onCreateAnswer(i);case 22:t.next=27;break;case 24:t.prev=24,t.t2=t["catch"](16),console.log("createAnswer: ",t.t2);case 27:case"end":return t.stop()}},t,this,[[0,5],[8,13],[16,24]])}));function e(e){return t.apply(this,arguments)}return e}(),onCreateAnswer:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.peerA.setLocalDescription(e);case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0),console.log("answer-setLocalDescription: ",t.t0);case 8:return t.prev=8,t.next=11,this.peerB.setRemoteDescription(e);case 11:t.next=16;break;case 13:t.prev=13,t.t1=t["catch"](8),console.log("answer-setRemoteDescription: ",t.t1);case 16:case"end":return t.stop()}},t,this,[[0,5],[8,13]])}));function e(e){return t.apply(this,arguments)}return e}(),initPeer:function(){var t=this,e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;this.peerA=new e,this.peerA.addStream(this.localstream),this.peerA.onicecandidate=function(e){e.candidate&&t.peerB.addIceCandidate(e.candidate)},this.peerB=new e,this.peerB.onaddstream=function(e){var i=document.querySelector("#rtcB");i.srcObject=e.stream,t.initPalette()},this.peerB.onicecandidate=function(e){e.candidate&&t.peerA.addIceCandidate(e.candidate)},this.allowCall=!1},createMedia:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.localstream=this.$refs["canvas"].captureStream(),this.initPeer();case 2:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){var t=this;this.$nextTick(function(){t.createMedia()})}},h=o,l=(i("a05d"),i("2877")),c=Object(l["a"])(h,n,a,!1,null,"f005d79c",null);e["default"]=c.exports},ebd66:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var n=i("d225"),a=i("b0b4"),s=function(){function t(e,i){var a=i.drawType,s=void 0===a?"line":a,r=i.drawColor,o=void 0===r?"rgba(19, 206, 102, 1)":r,h=i.lineWidth,l=void 0===h?5:h,c=i.sides,u=void 0===c?3:c,p=i.allowCallback,d=i.moveCallback;Object(n["a"])(this,t),this.canvas=e,this.width=e.width,this.height=e.height,this.paint=e.getContext("2d"),this.isClickCanvas=!1,this.isMoveCanvas=!1,this.imgData=[],this.index=0,this.x=0,this.y=0,this.last=[this.x,this.y],this.drawType=s,this.drawColor=o,this.lineWidth=l,this.sides=u,this.allowCallback=p||function(){},this.moveCallback=d||function(){},this.bindMousemove=function(){},this.bindMousedown=function(){},this.bindMouseup=function(){},this.init()}return Object(a["a"])(t,[{key:"init",value:function(){this.paint.fillStyle="#fff",this.paint.fillRect(0,0,this.width,this.height),this.gatherImage(),this.bindMousemove=this.onmousemove.bind(this),this.bindMousedown=this.onmousedown.bind(this),this.bindMouseup=this.onmouseup.bind(this),this.canvas.addEventListener("mousedown",this.bindMousedown),document.addEventListener("mouseup",this.bindMouseup)}},{key:"onmousedown",value:function(t){this.isClickCanvas=!0,this.x=t.offsetX,this.y=t.offsetY,this.last=[this.x,this.y],this.canvas.addEventListener("mousemove",this.bindMousemove)}},{key:"gatherImage",value:function(){this.imgData=this.imgData.slice(0,this.index+1);var t=this.paint.getImageData(0,0,this.width,this.height);this.imgData.push(t),this.index=this.imgData.length-1,this.allowCallback(this.index>0,this.index<this.imgData.length-1)}},{key:"reSetImage",value:function(){this.paint.clearRect(0,0,this.width,this.height),this.imgData.length>=1&&this.paint.putImageData(this.imgData[this.index],0,0)}},{key:"onmousemove",value:function(t){this.isMoveCanvas=!0;var e=t.offsetX,i=t.offsetY,n=e-this.x,a=i-this.y,s=[e,i];switch(this.drawType){case"line":var r=[this.last,s,this.lineWidth,this.drawColor];this.moveCallback.apply(this,["line"].concat(r)),this.line.apply(this,r);break;case"rect":var o=[this.x,this.y,n,a,this.lineWidth,this.drawColor];this.moveCallback.apply(this,["rect"].concat(o)),this.rect.apply(this,o);break;case"polygon":var h=[this.x,this.y,this.sides,n,a,this.lineWidth,this.drawColor];this.moveCallback.apply(this,["polygon"].concat(h)),this.polygon.apply(this,h);break;case"arc":var l=[this.x,this.y,n,a,this.lineWidth,this.drawColor];this.moveCallback.apply(this,["arc"].concat(l)),this.arc.apply(this,l);break;case"eraser":var c=[e,i,this.width,this.height,this.lineWidth];this.moveCallback.apply(this,["eraser"].concat(c)),this.eraser.apply(this,c);break}}},{key:"onmouseup",value:function(){this.isClickCanvas&&(this.isClickCanvas=!1,this.canvas.removeEventListener("mousemove",this.bindMousemove),this.isMoveCanvas&&(this.isMoveCanvas=!1,this.moveCallback("gatherImage"),this.gatherImage()))}},{key:"line",value:function(t,e,i,n){this.paint.beginPath(),this.paint.lineCap="round",this.paint.lineJoin="round",this.paint.lineWidth=i,this.paint.strokeStyle=n,this.paint.moveTo(t[0],t[1]),this.paint.lineTo(e[0],e[1]),this.paint.closePath(),this.paint.stroke(),this.last=e}},{key:"rect",value:function(t,e,i,n,a,s){this.reSetImage(),this.paint.lineWidth=a,this.paint.strokeStyle=s,this.paint.strokeRect(t,e,i,n)}},{key:"polygon",value:function(t,e,i,n,a,s,r){this.reSetImage();var o=i,h=360/o,l=Math.sqrt(Math.pow(n,2)+Math.pow(a,2));this.paint.beginPath(),this.paint.strokeStyle=r,this.paint.lineWidth=s;for(var c=0;c<o;c++)this.paint.lineTo(t+Math.sin((c*h+45)*Math.PI/180)*l,e+Math.cos((c*h+45)*Math.PI/180)*l);this.paint.closePath(),this.paint.stroke()}},{key:"arc",value:function(t,e,i,n,a,s){this.reSetImage(),this.paint.beginPath(),this.paint.lineWidth=a;var r=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));this.paint.arc(t,e,r,0,2*Math.PI,!1),this.paint.strokeStyle=s,this.paint.closePath(),this.paint.stroke()}},{key:"eraser",value:function(t,e,i,n,a){this.paint.save(),this.paint.beginPath(),this.paint.arc(t,e,a/2,0,2*Math.PI),this.paint.closePath(),this.paint.clip(),this.paint.clearRect(0,0,i,n),this.paint.fillStyle="#fff",this.paint.fillRect(0,0,i,n),this.paint.restore()}},{key:"cancel",value:function(){--this.index<0?this.index=0:(this.allowCallback(this.index>0,this.index<this.imgData.length-1),this.paint.putImageData(this.imgData[this.index],0,0))}},{key:"go",value:function(){++this.index>this.imgData.length-1?this.index=this.imgData.length-1:(this.allowCallback(this.index>0,this.index<this.imgData.length-1),this.paint.putImageData(this.imgData[this.index],0,0))}},{key:"clear",value:function(){this.imgData=[],this.paint.clearRect(0,0,this.width,this.height),this.paint.fillStyle="#fff",this.paint.fillRect(0,0,this.width,this.height),this.gatherImage()}},{key:"changeWay",value:function(t){var e=t.type,i=t.color,n=t.lineWidth,a=t.sides;this.drawType="color"!==e&&e||this.drawType,this.drawColor=i||this.drawColor,this.lineWidth=n||this.lineWidth,this.sides=a||this.sides}},{key:"destroy",value:function(){this.clear(),this.canvas.removeEventListener("mousedown",this.bindMousedown),document.removeEventListener("mouseup",this.bindMouseup),this.canvas=null,this.paint=null}}]),t}()}}]);