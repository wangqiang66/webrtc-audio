(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-588c1b34"],{"1ba9":function(e,t,n){},"7b39":function(e,t,n){"use strict";var r=n("1ba9"),a=n.n(r);a.a},e47c:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"remote1",attrs:{"element-loading-text":e.loadingText,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[e.isJoin?e._e():n("div",{staticClass:"shade"},[n("div",{staticClass:"input-container"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.account,expression:"account"}],attrs:{type:"text",placeholder:"请输入你的昵称"},domProps:{value:e.account},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.join(t)},input:function(t){t.target.composing||(e.account=t.target.value)}}}),n("button",{on:{click:e.join}},[e._v("确定")])])]),n("div",{staticClass:"userList"},[n("h5",[e._v("在线用户："+e._s(e.userList.length))]),e._l(e.userList,function(t){return n("p",{key:t.account},[e._v("\n            "+e._s(t.account)+"\n            "),t.account===e.account||t.account===e.isCall?n("i",[e._v("\n            "+e._s(t.account===e.account?"me":"")+"\n            "+e._s(t.account===e.isCall?"calling":"")+"\n            ")]):e._e(),t.account!==e.account&&t.account!==e.isCall?n("span",{on:{click:function(n){return e.apply(t.account)}}},[e._v("呼叫 "+e._s(t.account))]):e._e()])})],2),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isToPeer,expression:"isToPeer"}],staticClass:"video-container"},[n("div",[n("video",{attrs:{src:"",id:"rtcA",controls:"",autoplay:""}}),n("h5",[e._v(e._s(e.account))]),n("button",{on:{click:e.hangup}},[e._v("hangup")])]),n("div",[n("video",{attrs:{src:"",id:"rtcB",controls:"",autoplay:""}}),n("h5",[e._v(e._s(e.isCall))])])])])},a=[],i=(n("96cf"),n("3b8d")),c=n("29b2"),o={name:"remote1",data:function(){return{account:window.sessionStorage.account||"",isJoin:!1,userList:[],roomid:"webrtc_1v1",isCall:!1,loading:!1,loadingText:"呼叫中",isToPeer:!1,peer:null,offerOption:{offerToReceiveAudio:1,offerToReceiveVideo:1}}},methods:{join:function(){this.account&&(this.isJoin=!0,window.sessionStorage.account=this.account,c["a"].emit("join",{roomid:this.roomid,account:this.account}))},initSocket:function(){var e=this;c["a"].on("joined",function(t){e.userList=t}),c["a"].on("reply",function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.loading=!1,console.log(n),t.t0=n.type,t.next="1"===t.t0?5:"2"===t.t0?10:"3"===t.t0?12:14;break;case 5:return e.isCall=n.self,t.next=8,e.createP2P(n);case 8:return e.createOffer(n),t.abrupt("break",14);case 10:return e.$message({message:"对方拒绝了你的请求！",type:"warning"}),t.abrupt("break",14);case 12:return e.$message({message:"对方正在通话中！",type:"warning"}),t.abrupt("break",14);case 14:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),c["a"].on("apply",function(t){e.isCall?e.reply(t.self,"3"):e.$confirm(t.self+" 向你请求视频通话, 是否同意?","提示",{confirmButtonText:"同意",cancelButtonText:"拒绝",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.createP2P(t);case 2:e.isCall=t.self,e.reply(t.self,"1");case 4:case"end":return n.stop()}},n)}))).catch(function(){e.reply(t.self,"2")})}),c["a"].on("1v1answer",function(t){e.onAnswer(t)}),c["a"].on("1v1ICE",function(t){e.onIce(t)}),c["a"].on("1v1offer",function(t){e.onOffer(t)}),c["a"].on("1v1hangup",function(t){e.$message({message:"对方已断开连接！",type:"warning"}),e.peer.close(),e.peer=null,e.isToPeer=!1,e.isCall=!1})},hangup:function(){c["a"].emit("1v1hangup",{account:this.isCall,self:this.account}),this.peer.close(),this.peer=null,this.isToPeer=!1,this.isCall=!1},apply:function(e){this.loading=!0,this.loadingText="呼叫中",c["a"].emit("apply",{account:e,self:this.account})},reply:function(e,t){c["a"].emit("reply",{account:e,self:this.account,type:t})},createP2P:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,this.loadingText="正在建立通话连接",e.next=4,this.createMedia(t);case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),createMedia:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 3:this.localstream=e.sent,n=document.querySelector("#rtcA"),n.srcObject=this.localstream,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),console.log("getUserMedia: ",e.t0);case 11:this.initPeer(t);case 12:case"end":return e.stop()}},e,this,[[0,8]])}));function t(t){return e.apply(this,arguments)}return t}(),initPeer:function(e){var t=this,n=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;this.peer=new n,this.peer.addStream(this.localstream),this.peer.onicecandidate=function(n){n.candidate&&c["a"].emit("1v1ICE",{account:e.self,self:t.account,sdp:n.candidate})},this.peer.onaddstream=function(e){t.isToPeer=!0,t.loading=!1;var n=document.querySelector("#rtcB");n.srcObject=e.stream}},createOffer:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peer.createOffer(this.offerOption);case 3:return n=e.sent,e.next=6,this.peer.setLocalDescription(n);case 6:c["a"].emit("1v1offer",{account:t.self,self:this.account,sdp:n}),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),console.log("createOffer: ",e.t0);case 12:case"end":return e.stop()}},e,this,[[0,9]])}));function t(t){return e.apply(this,arguments)}return t}(),onOffer:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peer.setRemoteDescription(t.sdp);case 3:return e.next=5,this.peer.createAnswer();case 5:return n=e.sent,e.next=8,this.peer.setLocalDescription(n);case 8:c["a"].emit("1v1answer",{account:t.self,self:this.account,sdp:n}),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),console.log("onOffer: ",e.t0);case 14:case"end":return e.stop()}},e,this,[[0,11]])}));function t(t){return e.apply(this,arguments)}return t}(),onAnswer:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peer.setRemoteDescription(t.sdp);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),console.log("onAnswer: ",e.t0);case 8:case"end":return e.stop()}},e,this,[[0,5]])}));function t(t){return e.apply(this,arguments)}return t}(),onIce:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peer.addIceCandidate(t.sdp);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),console.log("onAnswer: ",e.t0);case 8:case"end":return e.stop()}},e,this,[[0,5]])}));function t(t){return e.apply(this,arguments)}return t}()},mounted:function(){this.initSocket(),this.account&&this.join()}},s=o,u=(n("7b39"),n("2877")),l=Object(u["a"])(s,r,a,!1,null,"5ba2d1a4",null);t["default"]=l.exports}}]);